<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Customer | Installment System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.8.4/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.4/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.4/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.4/firebase-storage-compat.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="logo-small">‚ûï</div>
                <div>
                    <h1>Add New Customer</h1>
                    <p class="admin-email" id="adminEmail">Loading...</p>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </a>
                <a href="add-customer.html" class="nav-link active">
                    <span class="nav-icon">‚ûï</span>
                    Add Customer
                </a>
                <a href="view-customers.html" class="nav-link">
                    <span class="nav-icon">üë•</span>
                    View Customers
                </a>
                <a href="reports.html" class="nav-link">
                    <span class="nav-icon">üìà</span>
                    Reports
                </a>
                <button id="logoutBtn" class="btn btn-logout">
                    <span class="nav-icon">üö™</span>
                    Logout
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h2>Add New Customer Account</h2>
                <p>Fill in all details including photos and warranty information</p>
                <div class="customer-id-preview">
                    Customer ID: <span id="previewCustomerID">Generating...</span>
                </div>
            </div>
            
            <!-- Customer Form -->
            <div class="form-container-large">
                <form id="customerForm" enctype="multipart/form-data">
                    
                    <!-- SECTION 1: Customer Basic Information -->
                    <div class="form-section">
                        <h3 class="section-title-with-icon">
                            <span class="section-icon">üë§</span>
                            Customer Personal Details
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="customerName">Full Name *</label>
                                <input type="text" id="customerName" placeholder="Enter customer's full name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerPhone">Phone Number *</label>
                                <input type="tel" id="customerPhone" placeholder="Enter 10-digit mobile number" 
                                       pattern="[0-9]{10}" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerEmail">Email Address</label>
                                <input type="email" id="customerEmail" placeholder="customer@email.com">
                            </div>
                            
                            <div class="form-group">
                                <label for="customerAddress">Complete Address *</label>
                                <textarea id="customerAddress" placeholder="House no, Street, City, State, PIN" 
                                          rows="3" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerNIC">NIC/Aadhaar Number *</label>
                                <input type="text" id="customerNIC" placeholder="Enter NIC/Aadhaar number" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerDOB">Date of Birth</label>
                                <input type="date" id="customerDOB">
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTION 2: Photo Uploads -->
                    <div class="form-section">
                        <h3 class="section-title-with-icon">
                            <span class="section-icon">üì∑</span>
                            Photo Uploads
                        </h3>
                        
                        <div class="photo-upload-grid">
                            <!-- Customer Photo -->
                            <div class="photo-upload-group">
                                <label for="customerPhoto">Customer Photo *</label>
                                <div class="photo-upload-area" id="customerPhotoArea">
                                    <div class="upload-placeholder">
                                        <span class="upload-icon">üë§</span>
                                        <p>Click to upload customer photo</p>
                                        <small>Max 2MB, JPG/PNG format</small>
                                    </div>
                                    <input type="file" id="customerPhoto" accept="image/*" 
                                           style="display: none;" required>
                                </div>
                                <div class="photo-preview" id="customerPhotoPreview"></div>
                            </div>
                            
                            <!-- NIC Photo -->
                            <div class="photo-upload-group">
                                <label for="nicPhoto">NIC/Aadhaar Photo *</label>
                                <div class="photo-upload-area" id="nicPhotoArea">
                                    <div class="upload-placeholder">
                                        <span class="upload-icon">üÜî</span>
                                        <p>Click to upload NIC photo</p>
                                        <small>Front side, clear image</small>
                                    </div>
                                    <input type="file" id="nicPhoto" accept="image/*" 
                                           style="display: none;" required>
                                </div>
                                <div class="photo-preview" id="nicPhotoPreview"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTION 3: Product Information -->
                    <div class="form-section">
                        <h3 class="section-title-with-icon">
                            <span class="section-icon">üõí</span>
                            Product Details
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="productCategory">Product Category *</label>
                                <select id="productCategory" required>
                                    <option value="">Select category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="appliances">Home Appliances</option>
                                    <option value="furniture">Furniture</option>
                                    <option value="vehicle">Vehicle</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="productName">Product Name *</label>
                                <input type="text" id="productName" placeholder="e.g., Samsung Refrigerator" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="productModel">Model Number</label>
                                <input type="text" id="productModel" placeholder="Model/SKU number">
                            </div>
                            
                            <div class="form-group">
                                <label for="productSerial">Serial Number</label>
                                <input type="text" id="productSerial" placeholder="Product serial number">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="productDescription">Product Description</label>
                                <textarea id="productDescription" placeholder="Additional product details" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTION 4: Warranty Information -->
                    <div class="form-section">
                        <h3 class="section-title-with-icon">
                            <span class="section-icon">üìã</span>
                            Warranty & Guarantee Details
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="warrantyType">Warranty Type</label>
                                <select id="warrantyType">
                                    <option value="">Select type</option>
                                    <option value="manufacturer">Manufacturer Warranty</option>
                                    <option value="seller">Seller Warranty</option>
                                    <option value="extended">Extended Warranty</option>
                                    <option value="none">No Warranty</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="warrantyPeriod">Warranty Period</label>
                                <input type="text" id="warrantyPeriod" placeholder="e.g., 1 Year, 6 Months">
                            </div>
                            
                            <div class="form-group">
                                <label for="warrantyStart">Warranty Start Date</label>
                                <input type="date" id="warrantyStart">
                            </div>
                            
                            <div class="form-group">
                                <label for="warrantyEnd">Warranty End Date</label>
                                <input type="date" id="warrantyEnd">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="warrantyTerms">Warranty Terms & Conditions</label>
                                <textarea id="warrantyTerms" placeholder="Important warranty terms" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="guaranteeCard">Guarantee Card Details</label>
                                <textarea id="guaranteeCard" placeholder="Guarantee card number and details" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTION 5: Payment Information -->
                    <div class="form-section">
                        <h3 class="section-title-with-icon">
                            <span class="section-icon">üí∞</span>
                            Payment Details
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="totalAmount">Total Product Price (‚Çπ) *</label>
                                <input type="number" id="totalAmount" placeholder="25000" step="0.01" min="0" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="downPayment">Down Payment (‚Çπ) *</label>
                                <input type="number" id="downPayment" placeholder="5000" step="0.01" min="0" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="installmentAmount">Monthly Installment (‚Çπ) *</label>
                                <input type="number" id="installmentAmount" placeholder="2000" step="0.01" min="0" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="installmentCount">Number of Installments *</label>
                                <input type="number" id="installmentCount" placeholder="12" min="1" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="startDate">Installment Start Date *</label>
                                <input type="date" id="startDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="dueDate">Next Due Date *</label>
                                <input type="date" id="dueDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="paymentMethod">Payment Method</label>
                                <select id="paymentMethod">
                                    <option value="cash">Cash</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="card">Card</option>
                                    <option value="upi">UPI</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="interestRate">Interest Rate (%)</label>
                                <input type="number" id="interestRate" placeholder="0" step="0.01" min="0">
                            </div>
                        </div>
                        
                        <!-- Payment Summary -->
                        <div class="payment-summary">
                            <h4>Payment Summary</h4>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <span>Total Amount:</span>
                                    <strong id="summaryTotal">‚Çπ0.00</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Down Payment:</span>
                                    <strong id="summaryDown">‚Çπ0.00</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Remaining Balance:</span>
                                    <strong id="summaryRemaining">‚Çπ0.00</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Monthly Installment:</span>
                                    <strong id="summaryMonthly">‚Çπ0.00</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Total Installments:</span>
                                    <strong id="summaryCount">0</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Completion Date:</span>
                                    <strong id="summaryCompletion">-</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTION 6: Additional Information -->
                    <div class="form-section">
                        <h3 class="section-title-with-icon">
                            <span class="section-icon">üìù</span>
                            Additional Information
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="referenceBy">Reference By</label>
                                <input type="text" id="referenceBy" placeholder="Who referred this customer?">
                            </div>
                            
                            <div class="form-group">
                                <label for="salesPerson">Sales Person</label>
                                <input type="text" id="salesPerson" placeholder="Name of sales executive">
                            </div>
                            
                            <div class="form-group">
                                <label for="customerStatus">Account Status</label>
                                <select id="customerStatus">
                                    <option value="Active">Active</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Overdue">Overdue</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="remarks">Remarks/Notes</label>
                                <textarea id="remarks" placeholder="Any additional notes or remarks" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="form-actions-large">
                        <button type="button" class="btn btn-secondary" onclick="window.location.href='dashboard.html'">
                            Cancel
                        </button>
                        <button type="reset" class="btn btn-outline">
                            Reset Form
                        </button>
                        <button type="submit" class="btn btn-primary btn-large">
                            <span class="btn-text">Save Customer Account</span>
                            <span class="btn-loader" style="display:none;">Saving...</span>
                        </button>
                    </div>
                </form>
                
                <!-- Message Box -->
                <div id="formMessage" class="message-box"></div>
            </div>
        </div>
    </main>
    
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const adminEmail = document.getElementById('adminEmail');
            const logoutBtn = document.getElementById('logoutBtn');
            const customerForm = document.getElementById('customerForm');
            const formMessage = document.getElementById('formMessage');
            const previewCustomerID = document.getElementById('previewCustomerID');
            
            // File upload elements
            const customerPhotoInput = document.getElementById('customerPhoto');
            const nicPhotoInput = document.getElementById('nicPhoto');
            const customerPhotoArea = document.getElementById('customerPhotoArea');
            const nicPhotoArea = document.getElementById('nicPhotoArea');
            const customerPhotoPreview = document.getElementById('customerPhotoPreview');
            const nicPhotoPreview = document.getElementById('nicPhotoPreview');
            
            let customerPhotoFile = null;
            let nicPhotoFile = null;
            
            // Check authentication
            firebase.auth().onAuthStateChanged(async (user) => {
                if (!user) {
                    window.location.href = 'index.html';
                } else {
                    adminEmail.textContent = user.email;
                    
                    // Generate and preview customer ID
                    const prefix = 'C'; // Can change to A, B, C etc.
                    try {
                        const customerID = await window.generateCustomerID(prefix);
                        previewCustomerID.textContent = customerID;
                        previewCustomerID.style.fontWeight = 'bold';
                        previewCustomerID.style.color = '#667eea';
                    } catch (error) {
                        console.error('Error generating ID:', error);
                        previewCustomerID.textContent = 'C001';
                    }
                }
            });
            
            // Logout
            logoutBtn.addEventListener('click', function() {
                firebase.auth().signOut().then(() => {
                    window.location.href = 'index.html';
                });
            });
            
            // Set default dates
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            
            document.getElementById('startDate').value = today.toISOString().split('T')[0];
            document.getElementById('dueDate').value = nextMonth.toISOString().split('T')[0];
            document.getElementById('warrantyStart').value = today.toISOString().split('T')[0];
            
            // Photo upload handlers
            customerPhotoArea.addEventListener('click', () => customerPhotoInput.click());
            nicPhotoArea.addEventListener('click', () => nicPhotoInput.click());
            
            customerPhotoInput.addEventListener('change', handlePhotoUpload.bind(null, 'customer'));
            nicPhotoInput.addEventListener('change', handlePhotoUpload.bind(null, 'nic'));
            
            // Payment calculation
            ['totalAmount', 'downPayment', 'installmentAmount', 'installmentCount', 'startDate'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculatePaymentSummary);
            });
            
            // Initial calculation
            calculatePaymentSummary();
            
            // Form submission
            customerForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitBtn = customerForm.querySelector('.btn-primary');
                const btnText = submitBtn.querySelector('.btn-text');
                const btnLoader = submitBtn.querySelector('.btn-loader');
                
                // Show loading
                btnText.style.display = 'none';
                btnLoader.style.display = 'inline-block';
                formMessage.innerHTML = '';
                
                try {
                    // Validate required photos
                    if (!customerPhotoFile) {
                        throw new Error('Please upload customer photo');
                    }
                    if (!nicPhotoFile) {
                        throw new Error('Please upload NIC photo');
                    }
                    
                    // Upload photos to Firebase Storage
                    const customerPhotoURL = await uploadPhoto(customerPhotoFile, 'customer_photos');
                    const nicPhotoURL = await uploadPhoto(nicPhotoFile, 'nic_photos');
                    
                    // Generate customer ID
                    const prefix = document.getElementById('productCategory').value === 'electronics' ? 'E' : 
                                  document.getElementById('productCategory').value === 'vehicle' ? 'V' : 'C';
                    const customerID = await window.generateCustomerID(prefix);
                    
                    // Prepare customer data
                    const customerData = {
                        // Basic Information
                        customerID: customerID,
                        name: document.getElementById('customerName').value.trim(),
                        phone: document.getElementById('customerPhone').value.trim(),
                        email: document.getElementById('customerEmail').value.trim() || '',
                        address: document.getElementById('customerAddress').value.trim(),
                        nicNumber: document.getElementById('customerNIC').value.trim(),
                        dob: document.getElementById('customerDOB').value || '',
                        
                        // Photos
                        customerPhoto: customerPhotoURL,
                        nicPhoto: nicPhotoURL,
                        
                        // Product Information
                        productCategory: document.getElementById('productCategory').value,
                        productName: document.getElementById('productName').value.trim(),
                        productModel: document.getElementById('productModel').value.trim() || '',
                        productSerial: document.getElementById('productSerial').value.trim() || '',
                        productDescription: document.getElementById('productDescription').value.trim() || '',
                        
                        // Warranty Information
                        warrantyType: document.getElementById('warrantyType').value || '',
                        warrantyPeriod: document.getElementById('warrantyPeriod').value || '',
                        warrantyStart: document.getElementById('warrantyStart').value || '',
                        warrantyEnd: document.getElementById('warrantyEnd').value || '',
                        warrantyTerms: document.getElementById('warrantyTerms').value.trim() || '',
                        guaranteeCard: document.getElementById('guaranteeCard').value.trim() || '',
                        
                        // Payment Information
                        totalAmount: parseFloat(document.getElementById('totalAmount').value) || 0,
                        downPayment: parseFloat(document.getElementById('downPayment').value) || 0,
                        installmentAmount: parseFloat(document.getElementById('installmentAmount').value) || 0,
                        installmentCount: parseInt(document.getElementById('installmentCount').value) || 0,
                        startDate: document.getElementById('startDate').value,
                        dueDate: document.getElementById('dueDate').value,
                        paymentMethod: document.getElementById('paymentMethod').value,
                        interestRate: parseFloat(document.getElementById('interestRate').value) || 0,
                        
                        // Calculated Fields
                        paidAmount: parseFloat(document.getElementById('downPayment').value) || 0,
                        remainingAmount: (parseFloat(document.getElementById('totalAmount').value) || 0) - 
                                       (parseFloat(document.getElementById('downPayment').value) || 0),
                        
                        // Additional Information
                        referenceBy: document.getElementById('referenceBy').value.trim() || '',
                        salesPerson: document.getElementById('salesPerson').value.trim() || '',
                        status: document.getElementById('customerStatus').value,
                        remarks: document.getElementById('remarks').value.trim() || '',
                        
                        // System Fields
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        createdBy: firebase.auth().currentUser.email
                    };
                    
                    // Validate data
                    if (customerData.downPayment > customerData.totalAmount) {
                        throw new Error('Down payment cannot be greater than total amount');
                    }
                    
                    if (customerData.installmentCount < 1) {
                        throw new Error('Number of installments must be at least 1');
                    }
                    
                    // Save to Firestore
                    const db = firebase.firestore();
                    await db.collection('customers').add(customerData);
                    
                    // Success message
                    formMessage.innerHTML = `
                        <div class="message success">
                            <h4>‚úÖ Customer Saved Successfully!</h4>
                            <p><strong>Customer ID:</strong> ${customerID}</p>
                            <p><strong>Name:</strong> ${customerData.name}</p>
                            <p>All details including photos have been saved.</p>
                            <div class="success-actions">
                                <a href="view-customers.html" class="btn btn-secondary">View All Customers</a>
                                <button onclick="printCustomerReceipt('${customerID}')" class="btn btn-primary">
                                    Print Receipt
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // Reset form
                    customerForm.reset();
                    
                    // Reset photos
                    customerPhotoPreview.innerHTML = '';
                    nicPhotoPreview.innerHTML = '';
                    customerPhotoFile = null;
                    nicPhotoFile = null;
                    
                    // Reset dates
                    const today = new Date();
                    const nextMonth = new Date();
                    nextMonth.setMonth(nextMonth.getMonth() + 1);
                    
                    document.getElementById('startDate').value = today.toISOString().split('T')[0];
                    document.getElementById('dueDate').value = nextMonth.toISOString().split('T')[0];
                    
                    // Generate new ID
                    const newID = await window.generateCustomerID(prefix);
                    previewCustomerID.textContent = newID;
                    
                    // Recalculate
                    calculatePaymentSummary();
                    
                } catch (error) {
                    console.error('Save error:', error);
                    formMessage.innerHTML = `
                        <div class="message error">
                            ‚ùå Error: ${error.message}
                            <p>Please check all fields and try again.</p>
                        </div>
                    `;
                } finally {
                    // Reset button
                    btnText.style.display = 'inline-block';
                    btnLoader.style.display = 'none';
                }
            });
            
            // Handle photo upload
            function handlePhotoUpload(type, event) {
                const file = event.target.files[0];
                if (!file) return;
                
                // Validate file size (2MB max)
                if (file.size > 2 * 1024 * 1024) {
                    alert('File size must be less than 2MB');
                    return;
                }
                
                // Validate file type
                if (!file.type.match('image.*')) {
                    alert('Please select an image file (JPG, PNG, etc.)');
                    return;
                }
                
                // Store file
                if (type === 'customer') {
                    customerPhotoFile = file;
                } else {
                    nicPhotoFile = file;
                }
                
                // Preview image
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = type === 'customer' ? customerPhotoPreview : nicPhotoPreview;
                    const area = type === 'customer' ? customerPhotoArea : nicPhotoArea;
                    
                    preview.innerHTML = `
                        <div class="preview-image">
                            <img src="${e.target.result}" alt="${type} preview">
                            <button type="button" class="remove-photo" onclick="removePhoto('${type}')">√ó</button>
                        </div>
                    `;
                    
                    area.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
            
            // Upload photo to Firebase Storage
            async function uploadPhoto(file, folder) {
                try {
                    const storage = firebase.storage();
                    const timestamp = Date.now();
                    const fileName = `${folder}/${timestamp}_${file.name}`;
                    const storageRef = storage.ref(fileName);
                    
                    // Upload file
                    const snapshot = await storageRef.put(file);
                    
                    // Get download URL
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    
                    return downloadURL;
                } catch (error) {
                    console.error('Upload error:', error);
                    throw new Error('Failed to upload photo');
                }
            }
            
            // Calculate payment summary
            function calculatePaymentSummary() {
                const total = parseFloat(document.getElementById('totalAmount').value) || 0;
                const down = parseFloat(document.getElementById('downPayment').value) || 0;
                const monthly = parseFloat(document.getElementById('installmentAmount').value) || 0;
                const count = parseInt(document.getElementById('installmentCount').value) || 0;
                const startDate = document.getElementById('startDate').value;
                
                const remaining = total - down;
                const calculatedMonthly = count > 0 ? remaining / count : 0;
                
                // Update summary
                document.getElementById('summaryTotal').textContent = '‚Çπ' + total.toFixed(2);
                document.getElementById('summaryDown').textContent = '‚Çπ' + down.toFixed(2);
                document.getElementById('summaryRemaining').textContent = '‚Çπ' + remaining.toFixed(2);
                document.getElementById('summaryMonthly').textContent = '‚Çπ' + (monthly || calculatedMonthly).toFixed(2);
                document.getElementById('summaryCount').textContent = count;
                
                // Calculate completion date
                if (startDate && count > 0) {
                    const start = new Date(startDate);
                    const completion = new Date(start);
                    completion.setMonth(completion.getMonth() + count);
                    document.getElementById('summaryCompletion').textContent = completion.toLocaleDateString('en-IN');
                } else {
                    document.getElementById('summaryCompletion').textContent = '-';
                }
                
                // Auto-fill installment amount if not set
                if (!document.getElementById('installmentAmount').value && count > 0) {
                    document.getElementById('installmentAmount').value = calculatedMonthly.toFixed(2);
                }
            }
        });
        
        // Global functions
        window.removePhoto = function(type) {
            if (type === 'customer') {
                document.getElementById('customerPhotoPreview').innerHTML = '';
                document.getElementById('customerPhotoArea').style.display = 'flex';
                customerPhotoFile = null;
            } else {
                document.getElementById('nicPhotoPreview').innerHTML = '';
                document.getElementById('nicPhotoArea').style.display = 'flex';
                nicPhotoFile = null;
            }
        };
        
        window.printCustomerReceipt = function(customerID) {
            alert(`Print receipt for customer ${customerID}\n\nThis feature can generate a printable receipt.`);
        };
    </script>
</body>
</html>
