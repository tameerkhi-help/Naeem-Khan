<!DOCTYPE html>
<html lang="en" dir="ltr" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Naeem Jan Traders - Management System</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="language-toggle">
        <button id="langToggle" class="lang-btn">
            <i class="fas fa-globe"></i>
            <span id="langText">اردو</span>
        </button>
    </div>

    <div id="login-section" class="container login-container">
        <div class="login-box">
            <div class="logo-header">
                <div class="logo-circle">
                    <i class="fas fa-handshake"></i>
                </div>
                <h2 data-en="Naeem Jan Traders" data-ur="نعیم جان ٹریڈرز">Naeem Jan Traders</h2>
                <p data-en="Secure Login" data-ur="محفوظ لاگ ان">Secure Login</p>
            </div>
            <form onsubmit="event.preventDefault(); login();">
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="admin-email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="admin-password" placeholder="Password" required>
                </div>
                <button type="submit" id="login-btn" class="login-btn">
                    <span data-en="Login Now" data-ur="لاگ ان کریں">Login Now</span>
                </button>
            </form>
            <p id="login-error" class="error"></p>
        </div>
    </div>

    <div id="dashboard-section" class="container dashboard-container hidden">
        <header>
            <div class="header-left">
                <div class="company-logo">
                    <i class="fas fa-store"></i>
                </div>
                <div>
                    <h1 data-en="Naeem Jan Traders" data-ur="نعیم جان ٹریڈرز">Naeem Jan Traders</h1>
                    <div class="status-dot"></div>
                </div>
            </div>
            <div class="header-right">
                <div class="stats-row">
                    <div class="stat-card">
                        <span class="stat-label" data-en="Total Customers" data-ur="کل کسٹمرز">Total Customers</span>
                        <span class="stat-value" id="total-customers">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label" data-en="Due Today" data-ur="آج واجب الادا">Due Today</span>
                        <span class="stat-value warning" id="due-today">0</span>
                    </div>
                    <div class="stat-card mobile-hide">
                        <span class="stat-label" data-en="Total Outstanding" data-ur="کل بقایا جات">Total Outstanding</span>
                        <span class="stat-value" id="total-balance">0</span>
                    </div>
                </div>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-power-off"></i>
                </button>
            </div>
        </header>

        <nav class="main-nav">
            <button onclick="showView('due-list-view')" class="nav-btn active-nav">
                <i class="fas fa-calendar-check"></i>
                <span data-en="Today's Due" data-ur="آج کی وصولی">Today's Due</span>
            </button>
            <button onclick="showView('search-view')" class="nav-btn">
                <i class="fas fa-search"></i>
                <span data-en="Search" data-ur="تلاش">Search</span>
            </button>
            <button onclick="showView('add-customer-view')" class="nav-btn">
                <i class="fas fa-user-plus"></i>
                <span data-en="New Customer" data-ur="نیا کسٹمر">New Customer</span>
            </button>
            <button onclick="showView('all-customers-view')" class="nav-btn">
                <i class="fas fa-users"></i>
                <span data-en="All List" data-ur="تمام لسٹ">All List</span>
            </button>
        </nav>

        <div id="due-list-view" class="content-view">
            <div class="view-header">
                <h3><span data-en="Pending Installments" data-ur="بقایا قسطیں">Pending Installments</span></h3>
                <button onclick="refreshDueList()" class="icon-btn">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="responsive-table">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th data-en="Account ID" data-ur="آئی ڈی">Account ID</th>
                            <th data-en="Name" data-ur="نام">Name</th>
                            <th data-en="Phone" data-ur="فون">Phone</th>
                            <th data-en="Installment" data-ur="قسط">Installment</th>
                            <th data-en="Due Date" data-ur="تاریخ">Due Date</th>
                            <th data-en="Actions" data-ur="ایکشن">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="due-customers-body">
                        </tbody>
                </table>
            </div>
            <div id="no-due-msg" class="empty-state hidden">
                <i class="fas fa-check-circle"></i>
                <p data-en="No dues for today" data-ur="آج کوئی وصولی نہیں ہے">No dues for today</p>
            </div>
        </div>

        <div id="search-view" class="content-view hidden">
            <div class="search-box-wrapper">
                <input type="text" id="search-input" placeholder="Search ID, Name or Phone..." class="big-search">
                <button onclick="searchCustomer()" class="search-submit-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="search-options">
                <label><input type="radio" name="search-type" value="id" checked> <span data-en="ID" data-ur="آئی ڈی">ID</span></label>
                <label><input type="radio" name="search-type" value="name"> <span data-en="Name" data-ur="نام">Name</span></label>
                <label><input type="radio" name="search-type" value="phone"> <span data-en="Phone" data-ur="فون">Phone</span></label>
            </div>
            <div id="search-result-container" class="cards-grid"></div>
        </div>

        <div id="add-customer-view" class="content-view hidden">
            <div class="view-header">
                <h3 id="form-title" data-en="Add New Customer" data-ur="نیا کسٹمر شامل کریں">Add New Customer</h3>
                <button onclick="resetForm()" class="text-btn" data-en="Clear" data-ur="صاف کریں">Clear</button>
            </div>
            
            <form id="customer-form">
                <input type="hidden" id="form-mode" value="add">
                <input type="hidden" id="original-account-id">
                
                <div class="form-card">
                    <h4 data-en="Personal Info" data-ur="ذاتی معلومات">Personal Info</h4>
                    <div class="form-grid">
                        <div class="input-wrapper">
                            <label data-en="Account ID *" data-ur="اکاؤنٹ آئی ڈی *">Account ID *</label>
                            <input type="text" id="accountId" required>
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Start Date" data-ur="تاریخ اجراء">Start Date</label>
                            <input type="date" id="issueDate">
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Name *" data-ur="نام *">Name *</label>
                            <input type="text" id="buyerName" required>
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Phone" data-ur="فون نمبر">Phone</label>
                            <input type="tel" id="phone">
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Father Name" data-ur="والد کا نام">Father Name</label>
                            <input type="text" id="fatherName">
                        </div>
                         <div class="input-wrapper">
                            <label data-en="Address" data-ur="پتہ">Address</label>
                            <input type="text" id="homeAddress">
                        </div>
                    </div>
                </div>

                <div class="form-card">
                    <h4 data-en="Product & Payment Details" data-ur="پروڈکٹ اور ادائیگی کی تفصیلات">Product & Payment Details</h4>
                    <div class="form-grid">
                        <div class="input-wrapper">
                            <label data-en="Item Name" data-ur="چیز کا نام">Item Name</label>
                            <input type="text" id="items" placeholder="e.g. iPhone 15, Fridge...">
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Total Price *" data-ur="کل قیمت *">Total Price *</label>
                            <input type="number" id="totalPrice" required onchange="calculateRemaining()">
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Advance Payment *" data-ur="ایڈوانس *">Advance Payment *</label>
                            <input type="number" id="advance" required value="0" onchange="calculateRemaining()">
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Monthly Installment *" data-ur="ماہانہ قسط *">Monthly Installment *</label>
                            <input type="number" id="monthlyInstallment" required>
                        </div>
                        
                        <div class="input-wrapper highlight-wrapper">
                            <label data-en="Old Customer? (Paid Installments)" data-ur="پرانا کسٹمر؟ (ادا شدہ قسطیں)">Old Customer? (Already Paid)</label>
                            <input type="number" id="pastPaidInstallments" placeholder="0" value="0" onchange="calculateRemaining()">
                            <small data-en="Enter number of months already paid" data-ur="جتنے مہینوں کی قسط دے چکا ہے وہ لکھیں">months paid</small>
                        </div>

                        <div class="input-wrapper">
                            <label data-en="Remaining Balance" data-ur="بقایا بیلنس">Remaining Balance</label>
                            <input type="number" id="initialRemaining" readonly class="readonly-input">
                        </div>
                    </div>
                </div>

                <div class="form-card">
                    <h4 data-en="Guarantors" data-ur="ضامن">Guarantors</h4>
                    <div class="form-grid">
                        <div class="input-wrapper">
                            <label data-en="Guarantor 1" data-ur="پہلا ضامن">Guarantor 1</label>
                            <input type="text" id="g1Name">
                        </div>
                        <div class="input-wrapper">
                            <label data-en="Guarantor 2" data-ur="دوسرا ضامن">Guarantor 2</label>
                            <input type="text" id="g2Name">
                        </div>
                    </div>
                </div>

                <div class="form-footer">
                    <button type="button" onclick="cancelEdit()" id="cancel-btn" class="secondary-btn hidden">Cancel</button>
                    <button type="submit" id="save-btn" class="primary-btn">Save Customer</button>
                </div>
            </form>
        </div>

        <div id="all-customers-view" class="content-view hidden">
            <div class="view-header">
                <h3><span data-en="All Customers" data-ur="تمام کسٹمرز">All Customers</span></h3>
                <input type="text" id="filter-customers" class="mini-search" placeholder="Filter...">
            </div>
            <div class="responsive-table">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th data-en="ID" data-ur="آئی ڈی">ID</th>
                            <th data-en="Name" data-ur="نام">Name</th>
                            <th data-en="Balance" data-ur="بقایا">Balance</th>
                            <th data-en="Actions" data-ur="ایکشن">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="all-customers-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="payment-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-en="Receive Payment" data-ur="ادائیگی وصول کریں">Receive Payment</h3>
                <button onclick="closeModal('payment-modal')" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="info-block">
                    <p id="pay-customer-name" class="bold-text"></p>
                    <p id="pay-balance-info"></p>
                </div>
                <div class="form-grid">
                    <div class="input-wrapper">
                        <label data-en="Amount" data-ur="رقم">Amount</label>
                        <input type="number" id="payment-amount" required>
                    </div>
                    <div class="input-wrapper">
                        <label data-en="Date" data-ur="تاریخ">Date</label>
                        <input type="date" id="payment-date" required>
                    </div>
                    <div class="input-wrapper full-width">
                        <label data-en="Notes" data-ur="نوٹ">Notes</label>
                        <textarea id="payment-notes" rows="2"></textarea>
                    </div>
                </div>
                <button onclick="submitPayment()" class="primary-btn full-width-btn" data-en="Confirm Payment" data-ur="ادائیگی محفوظ کریں">Confirm Payment</button>
            </div>
        </div>
    </div>

    <div id="customer-details-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3 data-en="Customer Details" data-ur="کسٹمر تفصیلات">Customer Details</h3>
                <button onclick="closeModal('customer-details-modal')" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="details-grid-layout">
                    <div class="details-card">
                        <h4 id="detail-name" class="customer-title">Name</h4>
                        <div class="detail-row">
                            <span data-en="ID:" data-ur="آئی ڈی:">ID:</span> <span id="detail-id"></span>
                        </div>
                        <div class="detail-row">
                            <span data-en="Phone:" data-ur="فون:">Phone:</span> <span id="detail-phone"></span>
                        </div>
                        <div class="detail-row">
                            <span data-en="Item:" data-ur="آئٹم:">Item:</span> <span id="detail-item"></span>
                        </div>
                        <div class="detail-row">
                            <span data-en="Address:" data-ur="پتہ:">Address:</span> <span id="detail-address"></span>
                        </div>
                        <div class="detail-actions">
                             <button onclick="editCurrentCustomer()" class="edit-btn-small" data-en="Edit" data-ur="ترمیم">Edit</button>
                             <button onclick="openDeleteModal()" class="delete-btn-small" data-en="Delete" data-ur="حذف">Delete</button>
                        </div>
                    </div>

                    <div class="details-card financial-card">
                        <div class="fin-row">
                            <span data-en="Total Price" data-ur="کل قیمت">Total Price</span>
                            <strong id="detail-total">0</strong>
                        </div>
                        <div class="fin-row">
                            <span data-en="Paid (Adv+Inst)" data-ur="ادا شدہ">Paid</span>
                            <strong id="detail-paid" class="text-success">0</strong>
                        </div>
                        <div class="fin-row">
                            <span data-en="Remaining" data-ur="بقایا">Remaining</span>
                            <strong id="detail-remaining" class="text-danger">0</strong>
                        </div>
                    </div>
                </div>

                <div class="ledger-section">
                    <h4 data-en="Installment History" data-ur="قسطوں کی تفصیل">Installment History</h4>
                    <div class="ledger-table-container">
                        <table class="ledger-table">
                            <thead>
                                <tr>
                                    <th data-en="Month" data-ur="مہینہ">Month</th>
                                    <th data-en="Expected" data-ur="متوقع">Expected</th>
                                    <th data-en="Status" data-ur="حالت">Status</th>
                                </tr>
                            </thead>
                            <tbody id="ledger-body">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="delete-modal" class="modal hidden">
        <div class="modal-content small-modal">
            <div class="modal-body text-center">
                <i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem; margin-bottom: 15px;"></i>
                <h3 data-en="Are you sure?" data-ur="کیا آپ کو یقین ہے؟">Are you sure?</h3>
                <p data-en="This will permanently delete this customer." data-ur="یہ کسٹمر ہمیشہ کے لیے حذف ہو جائے گا۔">This will permanently delete this customer.</p>
                <div class="modal-buttons">
                    <button onclick="closeModal('delete-modal')" class="secondary-btn" data-en="No, Cancel" data-ur="نہیں">No, Cancel</button>
                    <button onclick="confirmDelete()" class="delete-btn" data-en="Yes, Delete" data-ur="ہاں، حذف کریں">Yes, Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
