<!DOCTYPE html>
<html lang="ur" dir="rtl" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naeem Jan Traders - Installment System</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Language Toggle -->
    <div class="language-toggle">
        <button id="langToggle" class="lang-btn">
            <i class="fas fa-language"></i>
            <span id="langText">English</span>
        </button>
    </div>

    <!-- Login Section -->
    <div id="login-section" class="container">
        <div class="login-box">
            <div class="logo-header">
                <div class="logo-circle">
                    <i class="fas fa-store-alt"></i>
                </div>
                <h2 data-en="Naeem Jan Traders Login" data-ur="نعیم جان ٹریڈرز لاگ ان">نعیم جان ٹریڈرز لاگ ان</h2>
                <p data-en="Manage your installment system efficiently" data-ur="اپنی قسطیں منظم طریقے سے چلائیں">اپنی قسطیں منظم طریقے سے چلائیں</p>
            </div>
            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="admin-email" placeholder="Email" data-en="Email" data-ur="ای میل">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="admin-password" placeholder="Password" data-en="Password" data-ur="پاس ورڈ">
            </div>
            <button onclick="login()" class="login-btn" data-en="Login" data-ur="لاگ ان">لاگ ان</button>
            <p id="login-error" class="error"></p>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard-section" class="container hidden">
        <header>
            <div class="header-left">
                <div class="company-logo">
                    <i class="fas fa-store-alt"></i>
                </div>
                <div>
                    <h1 data-en="Naeem Jan Traders" data-ur="نعیم جان ٹریڈرز">نعیم جان ٹریڈرز</h1>
                    <p class="subtitle" data-en="Installment Management System" data-ur="قسط مینجمنٹ سسٹم">قسط مینجمنٹ سسٹم</p>
                </div>
            </div>
            <div class="header-right">
                <div class="stats-box">
                    <div class="stat">
                        <span class="stat-value" id="total-customers">0</span>
                        <span class="stat-label" data-en="Customers" data-ur="کسٹمرز">کسٹمرز</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="due-today">0</span>
                        <span class="stat-label" data-en="Due Today" data-ur="آج واجب">آج واجب</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="total-balance">0</span>
                        <span class="stat-label" data-en="Total Balance" data-ur="کل بقایا">کل بقایا</span>
                    </div>
                </div>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span data-en="Log Out" data-ur="لاگ آؤٹ">لاگ آؤٹ</span>
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav>
            <button onclick="showView('due-list-view')" class="nav-btn active-nav">
                <i class="fas fa-calendar-day"></i>
                <span data-en="Today's Due" data-ur="آج کی وصولیاں">آج کی وصولیاں</span>
            </button>
            <button onclick="showView('search-view')" class="nav-btn">
                <i class="fas fa-search"></i>
                <span data-en="Search Customer" data-ur="کسٹمر تلاش">کسٹمر تلاش</span>
            </button>
            <button onclick="showView('add-customer-view')" class="nav-btn">
                <i class="fas fa-user-plus"></i>
                <span data-en="Add New Customer" data-ur="نیا کسٹمر">نیا کسٹمر</span>
            </button>
            <button onclick="showView('all-customers-view')" class="nav-btn">
                <i class="fas fa-users"></i>
                <span data-en="All Customers" data-ur="تمام کسٹمرز">تمام کسٹمرز</span>
            </button>
        </nav>

        <!-- Due List View -->
        <div id="due-list-view" class="content-view">
            <div class="view-header">
                <h3><i class="fas fa-clipboard-list"></i> <span data-en="Customers with Due Installments" data-ur="وہ کسٹمرز جن کی قسط باقی ہے">وہ کسٹمرز جن کی قسط باقی ہے</span></h3>
                <button onclick="refreshDueList()" class="refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                    <span data-en="Refresh" data-ur="ریفریش">ریفریش</span>
                </button>
            </div>
            <div class="table-container">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th data-en="ID" data-ur="آئی ڈی">آئی ڈی</th>
                            <th data-en="Name" data-ur="نام">نام</th>
                            <th data-en="Phone" data-ur="فون">فون</th>
                            <th data-en="Monthly Installment" data-ur="ماہانہ قسط">ماہانہ قسط</th>
                            <th data-en="Balance" data-ur="بقایا">بقایا</th>
                            <th data-en="Next Due Date" data-ur="اگلی تاریخ">اگلی تاریخ</th>
                            <th data-en="Actions" data-ur="کارروائیاں">کارروائیاں</th>
                        </tr>
                    </thead>
                    <tbody id="due-customers-body">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
            <div id="no-due-msg" class="empty-state hidden">
                <i class="fas fa-check-circle"></i>
                <h4 data-en="All Installments Paid" data-ur="سب کی قسطیں ادا ہو چکی ہیں">سب کی قسطیں ادا ہو چکی ہیں</h4>
                <p data-en="No pending installments for today" data-ur="آج کے لیے کوئی بقایا قسط نہیں ہے">آج کے لیے کوئی بقایا قسط نہیں ہے</p>
            </div>
        </div>

        <!-- Search View -->
        <div id="search-view" class="content-view hidden">
            <div class="view-header">
                <h3><i class="fas fa-search"></i> <span data-en="Search Customer" data-ur="کسٹمر تلاش کریں">کسٹمر تلاش کریں</span></h3>
            </div>
            <div class="search-container">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search by ID, Name or Phone" data-en="Search by ID, Name or Phone" data-ur="آئی ڈی، نام یا فون سے تلاش کریں">
                    <button onclick="searchCustomer()" class="search-btn">
                        <span data-en="Search" data-ur="تلاش">تلاش</span>
                    </button>
                </div>
                <div class="search-filters">
                    <label>
                        <input type="radio" name="search-type" value="id" checked>
                        <span data-en="By ID" data-ur="آئی ڈی سے">آئی ڈی سے</span>
                    </label>
                    <label>
                        <input type="radio" name="search-type" value="name">
                        <span data-en="By Name" data-ur="نام سے">نام سے</span>
                    </label>
                    <label>
                        <input type="radio" name="search-type" value="phone">
                        <span data-en="By Phone" data-ur="فون سے">فون سے</span>
                    </label>
                </div>
            </div>
            <div id="search-result-container">
                <!-- Search results will appear here -->
            </div>
        </div>

        <!-- Add/Edit Customer View -->
        <div id="add-customer-view" class="content-view hidden">
            <div class="view-header">
                <h3><i class="fas fa-user-plus" id="form-icon"></i> <span id="form-title" data-en="Add New Customer" data-ur="نیا کسٹمر شامل کریں">نیا کسٹمر شامل کریں</span></h3>
                <button onclick="resetForm()" class="secondary-btn" id="reset-btn">
                    <i class="fas fa-redo"></i>
                    <span data-en="Reset Form" data-ur="فارم ری سیٹ">فارم ری سیٹ</span>
                </button>
            </div>
            
            <form id="customer-form">
                <input type="hidden" id="form-mode" value="add">
                <input type="hidden" id="original-account-id">
                
                <div class="form-sections">
                    <!-- Basic Info Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-id-card"></i>
                            <h4 data-en="Basic Information" data-ur="بنیادی معلومات">بنیادی معلومات</h4>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="accountId" data-en="Account ID *" data-ur="اکاؤنٹ آئی ڈی *">اکاؤنٹ آئی ڈی *</label>
                                <input type="text" id="accountId" required>
                            </div>
                            <div class="form-group">
                                <label for="issueDate" data-en="Issue Date" data-ur="تاریخ اجراء">تاریخ اجراء</label>
                                <input type="date" id="issueDate">
                            </div>
                            <div class="form-group">
                                <label for="buyerName" data-en="Buyer Name *" data-ur="خریدار کا نام *">خریدار کا نام *</label>
                                <input type="text" id="buyerName" required>
                            </div>
                            <div class="form-group">
                                <label for="phone" data-en="Mobile Number" data-ur="موبائل نمبر">موبائل نمبر</label>
                                <input type="text" id="phone">
                            </div>
                            <div class="form-group">
                                <label for="fatherName" data-en="Father Name" data-ur="والد کا نام">والد کا نام</label>
                                <input type="text" id="fatherName">
                            </div>
                            <div class="form-group">
                                <label for="profession" data-en="Profession" data-ur="پیشہ">پیشہ</label>
                                <input type="text" id="profession">
                            </div>
                            <div class="form-group full-width">
                                <label for="homeAddress" data-en="Home Address" data-ur="گھر کا پتہ">گھر کا پتہ</label>
                                <input type="text" id="homeAddress">
                            </div>
                            <div class="form-group full-width">
                                <label for="officeAddress" data-en="Office Address" data-ur="دفتر کا پتہ">دفتر کا پتہ</label>
                                <input type="text" id="officeAddress">
                            </div>
                        </div>
                    </div>

                    <!-- Images Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-images"></i>
                            <h4 data-en="Photos (Optional)" data-ur="تصاویر (اختیاری)">تصاویر (اختیاری)</h4>
                        </div>
                        <div class="image-upload-grid">
                            <div class="image-upload-box">
                                <label for="customerPhotoInput" class="upload-label">
                                    <i class="fas fa-camera"></i>
                                    <span data-en="Customer Photo" data-ur="کسٹمر کی تصویر">کسٹمر کی تصویر</span>
                                    <div id="customer-photo-preview" class="image-preview"></div>
                                </label>
                                <input type="file" id="customerPhotoInput" accept="image/*" hidden>
                            </div>
                            <div class="image-upload-box">
                                <label for="cnicPhotoInput" class="upload-label">
                                    <i class="fas fa-id-card"></i>
                                    <span data-en="CNIC Photo" data-ur="شناختی کارڈ">شناختی کارڈ</span>
                                    <div id="cnic-photo-preview" class="image-preview"></div>
                                </label>
                                <input type="file" id="cnicPhotoInput" accept="image/*" hidden>
                            </div>
                        </div>
                    </div>

                    <!-- Product & Payment Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-shopping-cart"></i>
                            <h4 data-en="Product & Payment" data-ur="پروڈکٹ اور ادائیگی">پروڈکٹ اور ادائیگی</h4>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="totalPrice" data-en="Total Price *" data-ur="کل قیمت *">کل قیمت *</label>
                                <input type="number" id="totalPrice" required onchange="calculateRemaining()">
                            </div>
                            <div class="form-group">
                                <label for="advance" data-en="Advance *" data-ur="ایڈوانس *">ایڈوانس *</label>
                                <input type="number" id="advance" required onchange="calculateRemaining()">
                            </div>
                            <div class="form-group">
                                <label for="initialRemaining" data-en="Remaining Balance" data-ur="بقایا بیلنس">بقایا بیلنس</label>
                                <input type="number" id="initialRemaining" readonly class="readonly">
                            </div>
                            <div class="form-group">
                                <label for="monthlyInstallment" data-en="Monthly Installment *" data-ur="ماہانہ قسط *">ماہانہ قسط *</label>
                                <input type="number" id="monthlyInstallment" required>
                            </div>
                            <div class="form-group">
                                <label for="items" data-en="Items Name" data-ur="سامان کا نام">سامان کا نام</label>
                                <input type="text" id="items">
                            </div>
                            <div class="form-group">
                                <label for="modelNumber" data-en="Model / Serial" data-ur="ماڈل / سیریل">ماڈل / سیریل</label>
                                <input type="text" id="modelNumber">
                            </div>
                        </div>
                    </div>

                    <!-- Guarantors Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-user-shield"></i>
                            <h4 data-en="Guarantors" data-ur="ضامن">ضامن</h4>
                        </div>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="g1Name" data-en="Guarantor 1 Name" data-ur="پہلے ضامن کا نام">پہلے ضامن کا نام</label>
                                <input type="text" id="g1Name">
                            </div>
                            <div class="form-group full-width">
                                <label for="g2Name" data-en="Guarantor 2 Name" data-ur="دوسرے ضامن کا نام">دوسرے ضامن کا نام</label>
                                <input type="text" id="g2Name">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" onclick="cancelEdit()" class="cancel-btn hidden" id="cancel-btn">
                        <span data-en="Cancel" data-ur="منسوخ">منسوخ</span>
                    </button>
                    <button type="submit" id="save-btn" class="save-btn">
                        <i class="fas fa-save"></i>
                        <span data-en="Save Customer" data-ur="کسٹمر محفوظ کریں">کسٹمر محفوظ کریں</span>
                    </button>
                </div>
                <p id="save-message" class="message"></p>
            </form>
        </div>

        <!-- All Customers View -->
        <div id="all-customers-view" class="content-view hidden">
            <div class="view-header">
                <h3><i class="fas fa-users"></i> <span data-en="All Customers" data-ur="تمام کسٹمرز">تمام کسٹمرز</span></h3>
                <div class="view-actions">
                    <input type="text" id="filter-customers" placeholder="Filter customers..." data-en="Filter customers..." data-ur="کسٹمرز فلٹر کریں..." class="filter-input">
                    <button onclick="exportCustomers()" class="secondary-btn">
                        <i class="fas fa-download"></i>
                        <span data-en="Export" data-ur="ایکسپورٹ">ایکسپورٹ</span>
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th data-en="ID" data-ur="آئی ڈی">آئی ڈی</th>
                            <th data-en="Name" data-ur="نام">نام</th>
                            <th data-en="Phone" data-ur="فون">فون</th>
                            <th data-en="Installment" data-ur="قسط">قسط</th>
                            <th data-en="Balance" data-ur="بقایا">بقایا</th>
                            <th data-en="Due Date" data-ur="تاریخ">تاریخ</th>
                            <th data-en="Status" data-ur="حالت">حالت</th>
                            <th data-en="Actions" data-ur="کارروائیاں">کارروائیاں</th>
                        </tr>
                    </thead>
                    <tbody id="all-customers-body">
                        <!-- All customers will be loaded here -->
                    </tbody>
                </table>
            </div>
            <div id="no-customers-msg" class="empty-state hidden">
                <i class="fas fa-users-slash"></i>
                <h4 data-en="No Customers Found" data-ur="کوئی کسٹمر نہیں ملا">کوئی کسٹمر نہیں ملا</h4>
                <p data-en="Add your first customer to get started" data-ur="شروع کرنے کے لیے پہلا کسٹمر شامل کریں">شروع کرنے کے لیے پہلا کسٹمر شامل کریں</p>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-en="Record Payment" data-ur="ادائیگی درج کریں">ادائیگی درج کریں</h3>
                <button onclick="closeModal()" class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="customer-info">
                    <h4 id="payment-customer-name"></h4>
                    <p data-en="Account ID:" data-ur="اکاؤنٹ آئی ڈی:">اکاؤنٹ آئی ڈی: <span id="payment-account-id"></span></p>
                    <p data-en="Current Balance:" data-ur="موجودہ بقایا:">موجودہ بقایا: Rs. <span id="payment-current-balance"></span></p>
                    <p data-en="Monthly Installment:" data-ur="ماہانہ قسط:">ماہانہ قسط: Rs. <span id="payment-installment-amount"></span></p>
                </div>
                <div class="payment-form">
                    <div class="form-group">
                        <label for="payment-amount" data-en="Payment Amount *" data-ur="ادائیگی کی رقم *">ادائیگی کی رقم *</label>
                        <input type="number" id="payment-amount" required>
                    </div>
                    <div class="form-group">
                        <label for="payment-date" data-en="Payment Date *" data-ur="ادائیگی کی تاریخ *">ادائیگی کی تاریخ *</label>
                        <input type="date" id="payment-date" required>
                    </div>
                    <div class="form-group">
                        <label for="payment-method" data-en="Payment Method" data-ur="ادائیگی کا طریقہ">ادائیگی کا طریقہ</label>
                        <select id="payment-method">
                            <option value="cash" data-en="Cash" data-ur="کیش">کیش</option>
                            <option value="bank" data-en="Bank Transfer" data-ur="بینک ٹرانسفر">بینک ٹرانسفر</option>
                            <option value="jazzcash" data-en="JazzCash" data-ur="جازکیش">جازکیش</option>
                            <option value="easypaisa" data-en="EasyPaisa" data-ur="ایزی پیسہ">ایزی پیسہ</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="payment-notes" data-en="Notes (Optional)" data-ur="نوٹ (اختیاری)">نوٹ (اختیاری)</label>
                        <textarea id="payment-notes" rows="2"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()" class="cancel-btn">
                    <span data-en="Cancel" data-ur="منسوخ">منسوخ</span>
                </button>
                <button onclick="submitPayment()" class="save-btn">
                    <i class="fas fa-check-circle"></i>
                    <span data-en="Record Payment" data-ur="ادائیگی درج کریں">ادائیگی درج کریں</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> <span data-en="Confirm Delete" data-ur="حذف کرنے کی تصدیق">حذف کرنے کی تصدیق</span></h3>
                <button onclick="closeDeleteModal()" class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p data-en="Are you sure you want to delete this customer? This action cannot be undone." data-ur="کیا آپ واقعی اس کسٹمر کو حذف کرنا چاہتے ہیں؟ یہ کارروائی واپس نہیں ہو سکتی۔">کیا آپ واقعی اس کسٹمر کو حذف کرنا چاہتے ہیں؟ یہ کارروائی واپس نہیں ہو سکتی۔</p>
                <div class="customer-info">
                    <h4 id="delete-customer-name"></h4>
                    <p data-en="Account ID:" data-ur="اکاؤنٹ آئی ڈی:">اکاؤنٹ آئی ڈی: <span id="delete-account-id"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeDeleteModal()" class="cancel-btn">
                    <span data-en="Cancel" data-ur="منسوخ">منسوخ</span>
                </button>
                <button onclick="confirmDelete()" class="delete-confirm-btn">
                    <i class="fas fa-trash-alt"></i>
                    <span data-en="Delete Customer" data-ur="کسٹمر حذف کریں">کسٹمر حذف کریں</span>
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
